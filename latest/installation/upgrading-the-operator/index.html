<!DOCTYPE html>
<html>
  <head>
    <title>Crunchy Data PostgreSQL Operator Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.48" />
<title>Upgrading the Operator :: Crunchy Data PostgreSQL Operator Documentation</title>
<link rel="shortcut icon" href="https://crunchydata.github.io/postgres-operator/latest/favicon.png" type="image/x-icon" />
<link href="https://crunchydata.github.io/postgres-operator/latest/css/nucleus.css" rel="stylesheet">
<link href="https://crunchydata.github.io/postgres-operator/latest/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="https://crunchydata.github.io/postgres-operator/latest/css/bootstrap.min.css">
<link href="https://crunchydata.github.io/postgres-operator/latest/css/custom.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
<script src="https://crunchydata.github.io/postgres-operator/latest/js/jquery-2.x.min.js"></script>
<script src="https://crunchydata.github.io/postgres-operator/latest/js/toc.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/crunchydata.github.io\/postgres-operator\/latest\/";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/installation/upgrading-the-operator/">
    
      <header>
  <div class="logo">
    
	
  
    <img alt="Crunchy Data" src="https://crunchydata.github.io/postgres-operator/latest/images/logo.svg">
  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://github.com/CrunchyData/postgres-operator"  rel="noopener">
                  <i class='fab fa-github'></i> <label>Source</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://kubernetes.io/docs/"  rel="noopener">
                  <i class='fas fa-bookmark'></i> <label>Kubernetes</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/CrunchyData/postgres-operator/blob/master/LICENSE.md"  rel="noopener">
                  <i class='fas fa-file-contract'></i> <label>License</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>

    <ul class="menu">
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="">
        </div>
        <script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/latest/js/lunr.min.js"></script>
        <script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/latest/js/auto-complete.js"></script>
        <link href="https://crunchydata.github.io/postgres-operator/latest/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/crunchydata.github.io\/postgres-operator\/latest\/";
          
        </script>
        <script type="text/javascript" src="https://crunchydata.github.io/postgres-operator/latest/js/search.js"></script>
      </div>

      <hr>
      <a class="baselink" href="https://crunchydata.github.io/postgres-operator/latest/">Crunchy Data PostgreSQL Operator Documentation</a>
      <hr>
        <b>Available Formats</b>
        <nav class="downloads">
                <li class="" role="">
                    <a href="https://crunchydata.github.io/postgres-operator/latest/pdf/postgres-operator.pdf"  rel="noopener">
                      <i class='fas fa-file-pdf'></i> <label>PDF</label>
                    </a>
                </li>
        </nav>
        <hr>

      <b>Navigation</b>
          <li data-nav-id="/" class="dd-item">
          <a href="https://crunchydata.github.io/postgres-operator/latest/">
            Home
          </a>
          </li>
    <li data-nav-id="/installation/" class="dd-item parent haschildren
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/installation/">Installation</a>
            <i class="fas fa-angle-down fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="/installation/quick-installation/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/quick-installation/">
            Quick Installation
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/manual-installation/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/manual-installation/">
            Manual Installation
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/helm-chart/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/helm-chart/">
            Helm Chart
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/configuration/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/configuration/">
            Configuration
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/deployment/" class="dd-item">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/deployment/">
            Deployment
          </a>
        </div>
    </li>
      <li data-nav-id="/installation/upgrading-the-operator/" class="dd-item active">
        <div>
          <a href="https://crunchydata.github.io/postgres-operator/latest/installation/upgrading-the-operator/">
            Upgrading the Operator
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/getting-started/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/getting-started/">Getting Started</a>

      </div>
    </li>
    <li data-nav-id="/how-it-works/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/how-it-works/">How it Works</a>

      </div>
    </li>
    <li data-nav-id="/contributing/" class="dd-item
        ">
      <div>
      <a href="https://crunchydata.github.io/postgres-operator/latest/contributing/">Contributing</a>

      </div>
    </li>




      <hr><b>Table of Contents</b>
<nav id="TableOfContents"></nav>



      <section>
      </section>
    </ul>
  </aside>
  <section class="page">

    <div class="nav-select">
      <center>Navigation :
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/installation/" >
   Installation</option> 
      <option value="/installation/quick-installation/" >- Quick Installation</option>
      <option value="/installation/manual-installation/" >- Manual Installation</option>
      <option value="/installation/helm-chart/" >- Helm Chart</option>
      <option value="/installation/configuration/" >- Configuration</option>
      <option value="/installation/deployment/" >- Deployment</option>
      <option value="/installation/upgrading-the-operator/"  selected>- Upgrading the Operator</option>
  
    <option value="/getting-started/" >
   Getting Started</option>
    <option value="/how-it-works/" >
   How it Works</option>
    <option value="/contributing/" >
   Contributing</option>



        </select>
      </center>
    </div>

    
      <div id="top-bar">
        
          
          
          
        <div id="top-github-link">
          <a class="github-link" href="https://crunchydata.github.io/postgres-operator/latest/contributing/" target="blank">
            <i class="fa fa-info-circle"></i>
            
          </a>
          <a class="github-link" href="https://github.com/CrunchyData/postgres-operator/edit/master/hugo/content/installation/upgrading-the-operator.adoc" target="blank">
            <i class="fa fa-code-fork"></i>
            
          </a>
        </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            <span class="links">
            







 <a href='https://crunchydata.github.io/postgres-operator/latest/'>Crunchy Data PostgreSQL Operator</a> > <a href='https://crunchydata.github.io/postgres-operator/latest/installation/'>Installation</a> > Upgrading the Operator

 

 


            </span>
        </div>

      </div>
    

    
    <div id="body-inner">

    <h1>Upgrading the Operator</h1>

    
    
    
    <div class="paragraph">
<p>Latest Release: 3.5.0 2018-12-14</p>
</div>
<div class="paragraph">
<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fa fa-chevron-right"></i>
        <span>
        
        
        Upgrading to v3.5
        
        </span>
    </div>
    <div class="expand-content" style="display: none;">
<div class="ulist">
<ul>
<li>
<p>the pgingest CRD is removed, you will need to manually remove it from any
deployments of the operator after upgrading to this version, this includes
removing ingest related permissions from the pgorole file, the API server also
removes the ingest related API endpoints</p>
</li>
<li>
<p>primary and replica labels are only applicable at cluster creation and not
updated after a cluster has executed a failover, a new service-name label is
applied to PG cluster components to indidate whether a deployment/pod is a primary
or replica, service-name is also the label now used by the cluster services
to route with.  This scheme allows for an almost immediate failover promotion
and avoids the pod having to be bounced as part of a failover.  Any existing
PG clusters will need to be updated to specify them as a primary or replica
using the new service-name labeling scheme.  A sample upgrade script is
included in the bin directory name upgrade-to-35.sh, you would run this script
to upgrade any existing clusters to the new labeling scheme whereby you can
run a failover on existing PG clusters deployed prior to 3.5.0.</p>
</li>
<li>
<p>the autofail label was moved from deployments and pods to just the pgcluster
CRD to support autofail toggling</p>
</li>
<li>
<p>the storage configurations in pgo.yaml support the MatchLabels attribute
for NFS storage, this will allow users to have more than a single NFS backend,
when set, this label (key=value) will be used to match the labels on PVs
when a PVC is created.</p>
</li>
<li>
<p>the UpdateCluster permission was added to the sample pgorole file to support the
new pgo update CLI command, and also added to the pgoperm file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&lt;div class="expand"&gt;
    &lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&gt;
        &lt;i style="font-size:x-small;" class="fa fa-chevron-right"&gt;&lt;/i&gt;
        &lt;span&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Upgrading to v3.4</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="expand-content" style="display: none;"&gt;
&lt;div class="ulist"&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The conf/apiserver/ configuration files were moved into the
conf/postgres-operator directory to consolidate all config
files into a single location.  You will need to perform
this step manually start with version 3.4.0 if you are running
an existing Operator version prior to 3.4.0.  The Helm chart
is also updated to reflect this change.  Starting with 3.4.0
there is a secret, &lt;strong&gt;pgo-auth-secret&lt;/strong&gt; that holds authentication and
authorization files used by the operator to authenticate REST
clients.  Also, the configuration files are stored in a configmap
named &lt;strong&gt;pgo-config&lt;/strong&gt;.  Existing users will need to update
their deploy.sh script and deployment.yaml files to pick up the
the new naming conventions.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;new configuration settings were added into pgo.yaml to support
resource configuration settings for the various &lt;strong&gt;helper&lt;/strong&gt; containers.
The new settings include DefaultLoadResources, DefaultLspvcResources,
DefaultRmdataResources, DefaultBackupResources.  You will need to add
these manually into your existing pgo.yaml file if you want to
make use of this feature.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;the pgcluster CRD was changed to remove the password fields, instead
secret names are stored in the CRD to avoid having to have passwords
in the CRD, the password fields are totally removed starting in this
release. No changes are required for existing CRD resources, new
CRDs that are created will not have the  password fields.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;starting in 3.4, a new operator upgrade process is developed that
eventually will handle various forms of automated upgrades depending
on user settings and changes to the postgres-operator in between
versions.  When starting a new Operator it will scan the pgcluster
and pgreplica instances and update the pgo-version to match the
current operator version, it will also create a user label on
the pgreplica/pgcluster to indicate the upgrade date.  More advanced
upgrade features are planned to be developed.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;in 3.4, the pgo.yaml LogStatement and LogMinDurationStatement settings
are present, if not set, defaults are supplied for both.  These settings
let you define more precisely the degree of Postgres logging for
any Postgres clusters created by the Operator.  The LogStatement default
is 'none' and the LogMinDurationStatement defaults to 60000 (milliseconds).
These settings greatly reduce the log file sizes and only will log
statements that are longer running that 60000 milliseconds.  If you
want to see all statements logged, set LogStatement to 'all'.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;in 3.4, the pgbackup CRD includes a new field called BackupOpts, used
to hold the pgbasebackup command options which can now be passed in
on the CLI backup command, no changes to existing pgbackup CRD resources is
required.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;operator 3.3 introduced the alpha version of pgbackrest integration.
Now in 3.4, the pgbackrest integration was changed so that users
no longer have to specify a custom configuration file using &lt;strong&gt;--custom-config&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;the pgo-backrest backup-job is secured with a new service account
named pgo-backrest, that SA is now included in the rbac.yaml file and is
to be created by an a cluster admin user&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;the permission SHOW_WORKFLOW_PERM was created and added to the default pgorole example, this permission lets users view workflow status, workflows are stored as pgtask CRDs&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;With 3.4, there is a global configmap created as part of the
deployment process which will serve this same purpose, that is to
indicate to the Postgres container that it must allocate the pgbackrest
directories within the mounted /backrestrepo volume mount.  This
means however, that if you specify a global configuration file or
specify your own custom configuration that you have to include
the pgbackrest.conf file and key within that configmap.  The sample
global custom configuration map, pgo-custom-pg-config, now includes
pgbackrest.conf within it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;This new integration only works with pgbackrest v2.6 which is included
into crunchy-postgres 2.2.0.  This means that to use pgbackrest, you
must run crunchy-postgres 2.2.0 or greater which will require users
to upgrade the pgo.yaml to use the 2.2.0 CCPImageTag.  pgbackrest commands
will NOT work with clusters using older Postgres images.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&amp;lt;div class="expand"&amp;gt;
    &amp;lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&amp;gt;
        &amp;lt;i style="font-size:x-small;" class="fa fa-chevron-right"&amp;gt;&amp;lt;/i&amp;gt;
        &amp;lt;span&amp;gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;Upgrading to v3.3&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;        &amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class="expand-content" style="display: none;"&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;The following changes are mandatory when upgrading to 3.3 from previous operator versions:&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="ulist"&amp;gt;
&amp;lt;ul&amp;gt;
&amp;lt;li&amp;gt;
&amp;lt;p&amp;gt;The MatchLabels attribute was added to the pgo.yaml file as an optional
storage configuration setting. You do not have to specify this setting,
however, the operator-conf ConfigMap now has to include the &amp;lt;code&amp;gt;pvc-matchlabels.json&amp;lt;/code&amp;gt;
template file as required by this new feature. If you upgrade to
3.2, you will need to rebuild your &amp;lt;strong&amp;gt;operator-conf&amp;lt;/strong&amp;gt; ConfigMap to include
&amp;lt;code&amp;gt;pvc-matchlabels.json&amp;lt;/code&amp;gt; and redeploy the Operator using the new ConfigMap.&amp;lt;/p&amp;gt;
&amp;lt;/li&amp;gt;
&amp;lt;li&amp;gt;
&amp;lt;p&amp;gt;The &amp;lt;code&amp;gt;CCP_IMAGE_PREFIX&amp;lt;/code&amp;gt;, &amp;lt;code&amp;gt;CO_IMAGE_PREFIX&amp;lt;/code&amp;gt;, and &amp;lt;code&amp;gt;CO_IMAGE_TAG&amp;lt;/code&amp;gt; environment variables are now pulled from the &amp;lt;code&amp;gt;pgo.yaml&amp;lt;/code&amp;gt; configuration file that is mounted by both the apiserver and operator containers. To clean up an existing deployment, remove these environment variable definitions from your &amp;lt;code&amp;gt;deployment.yaml&amp;lt;/code&amp;gt; file or Helm chart equivalent.&amp;lt;/p&amp;gt;
&amp;lt;/li&amp;gt;
&amp;lt;li&amp;gt;
&amp;lt;p&amp;gt;The &amp;lt;code&amp;gt;ExternalIP&amp;lt;/code&amp;gt; field was added to the &amp;lt;code&amp;gt;apiservermsgs.ShowClusterService&amp;lt;/code&amp;gt;
struct. This field is now passed back to apiserver clients in the
REST API when viewing cluster details. For custom clients you might
have written, you will see this new field in the REST message.&amp;lt;/p&amp;gt;
&amp;lt;/li&amp;gt;
&amp;lt;li&amp;gt;
&amp;lt;p&amp;gt;Clusters that were created prior to 3.1 will need a new label to be applied. For primary deployments, apply the label &amp;lt;code&amp;gt;primary=true&amp;lt;/code&amp;gt;. For example, &amp;lt;code&amp;gt;kubectl label deploy mycluster primary=true&amp;lt;/code&amp;gt;. For replica deployments, specify &amp;lt;code&amp;gt;primary=false&amp;lt;/code&amp;gt;. For example,	&amp;lt;code&amp;gt;kubectl label deploy mycluster-xxxx primary=false&amp;lt;/code&amp;gt;.&amp;lt;/p&amp;gt;
&amp;lt;/li&amp;gt;
&amp;lt;li&amp;gt;
&amp;lt;p&amp;gt;The &amp;lt;code&amp;gt;collect.json&amp;lt;/code&amp;gt; template now specifies a pgmonitor credential that
must match the &amp;lt;code&amp;gt;PGMONITOR_PASSWORD&amp;lt;/code&amp;gt; environment variable which was
added into the &amp;lt;code&amp;gt;cluster-deployment-1.json&amp;lt;/code&amp;gt; template.  These changes
were required to support crunchy-collect (2.1.0) changes that were
introduced.  Users should upgrade to &amp;lt;code&amp;gt;crunchy-collect:centos7-10.5-2.1.0&amp;lt;/code&amp;gt;
to use this feature.  If you do not want to upgrade to this new
metrics collector, you will need to retain and reuse the prior version
of &amp;lt;code&amp;gt;collect.json&amp;lt;/code&amp;gt; used by the Operator and make sure you deploy that
version.&amp;lt;/p&amp;gt;
&amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;
&amp;lt;/div&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&amp;lt;div class="expand"&amp;gt;
    &amp;lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&amp;gt;
        &amp;lt;i style="font-size:x-small;" class="fa fa-chevron-right"&amp;gt;&amp;lt;/i&amp;gt;
        &amp;lt;span&amp;gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;Upgrading from v2.6 to v3.1&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;        &amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class="expand-content" style="display: none;"&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;Clusters that were created prior to 3.1 will need a new label to be applied.
For primary deployments, apply the label &amp;lt;code&amp;gt;primary=true&amp;lt;/code&amp;gt;. For example,
&amp;lt;code&amp;gt;kubectl label deploy mycluster primary=true&amp;lt;/code&amp;gt;. For replica deployments, specify
&amp;lt;code&amp;gt;primary=false&amp;lt;/code&amp;gt;. For example,	&amp;lt;code&amp;gt;kubectl label deploy mycluster-xxxx primary=false&amp;lt;/code&amp;gt;.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&amp;lt;div class="expand"&amp;gt;
    &amp;lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&amp;gt;
        &amp;lt;i style="font-size:x-small;" class="fa fa-chevron-right"&amp;gt;&amp;lt;/i&amp;gt;
        &amp;lt;span&amp;gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;Upgrading from v2.4 to v2.5&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;        &amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class="expand-content" style="display: none;"&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;For a full list of additions and revisions that occurred in the
PostgreSQL Operator v2.5 release, please view the related release
page &amp;lt;a href="https://github.com/CrunchyData/postgres-operator/releases/tag/2.5"&amp;gt;here&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect1"&amp;gt;
&amp;lt;h2 id="_required_updates"&amp;gt;Required Updates&amp;lt;/h2&amp;gt;
&amp;lt;div class="sectionbody"&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;This section notes some required steps that will need to be taken
in the process of upgrading from v2.4 to v2.5.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect2"&amp;gt;
&amp;lt;h3 id="_configuration_file"&amp;gt;Configuration File&amp;lt;/h3&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;It will be necessary to update your existing &amp;lt;code&amp;gt;pgo.yaml&amp;lt;/code&amp;gt; configuration
file where the Storage Configuration sections are concerned. The updated
file for v2.5 can be found
&amp;lt;a href="https://github.com/CrunchyData/postgres-operator/blob/2.5/conf/apiserver/pgo.yaml"&amp;gt;here&amp;lt;/a&amp;gt;.
The file contained within the local installation of the Operator is located
by default in the following location -&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="literalblock"&amp;gt;
&amp;lt;div class="content"&amp;gt;
&amp;lt;pre&amp;gt;$COROOT/conf/apiserver/pgo.yaml&amp;lt;/pre&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect2"&amp;gt;
&amp;lt;h3 id="_secrets"&amp;gt;Secrets&amp;lt;/h3&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;2.5 changed the names of the database credentials that are created
by default in order to be consistent with the way new database credentials
are named.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;It will be necessary to run the following script to update your
existing clusters. This script will essentially copy the existing
secrets values and create new secrets with those same values but
named to the new standard. Run the script by passing in the name of
an existing cluster as a parameter.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="literalblock"&amp;gt;
&amp;lt;div class="content"&amp;gt;
&amp;lt;pre&amp;gt;$COROOT/bin/upgrade-secret.sh&amp;lt;/pre&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;
&lt;p&gt;&amp;lt;div class="expand"&amp;gt;
    &amp;lt;div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fa fa-chevron-down' : 'fa fa-chevron-right';});});"&amp;gt;
        &amp;lt;i style="font-size:x-small;" class="fa fa-chevron-right"&amp;gt;&amp;lt;/i&amp;gt;
        &amp;lt;span&amp;gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;Upgrading from v2.5 to v2.6&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;        &amp;lt;/span&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div class="expand-content" style="display: none;"&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;For a full list of additions and revisions that occurred in the
PostgreSQL Operator v2.5 release, please view the related release
page &amp;lt;a href="https://github.com/CrunchyData/postgres-operator/releases/tag/3.3.0"&amp;gt;here&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect1"&amp;gt;
&amp;lt;h2 id="_required_updates"&amp;gt;Required Updates&amp;lt;/h2&amp;gt;
&amp;lt;div class="sectionbody"&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;This section notes some required steps that will need to be taken
in the process of upgrading from v2.5 to v2.6.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect2"&amp;gt;
&amp;lt;h3 id="_configuration_file"&amp;gt;Configuration File&amp;lt;/h3&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;One update in v2.6 changed the &amp;lt;code&amp;gt;pgo.yaml&amp;lt;/code&amp;gt; file through removing the Debug flag.
The &amp;lt;code&amp;gt;Pgo.Debug&amp;lt;/code&amp;gt; variable can now be removed from the &amp;lt;code&amp;gt;pgo.yaml&amp;lt;/code&amp;gt; file as a
result. The debug flag is now called &amp;lt;code&amp;gt;CRUNCHY_DEBUG&amp;lt;/code&amp;gt; and is set in the
&amp;lt;code&amp;gt;deployment.json&amp;lt;/code&amp;gt; file as a default environment variable.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect2"&amp;gt;
&amp;lt;h3 id="_container_resources"&amp;gt;Container Resources&amp;lt;/h3&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;Release 2.6 added the concept of container resource configurations
to the &amp;lt;code&amp;gt;pgo.yaml&amp;lt;/code&amp;gt; file. In order to specify the optional container
resource configurations, add a section as follows to your &amp;lt;code&amp;gt;pgo.yaml&amp;lt;/code&amp;gt;
file -&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="literalblock"&amp;gt;
&amp;lt;div class="content"&amp;gt;
&amp;lt;pre&amp;gt;DefaultContainerResource: small
ContainerResources:
 small:
   RequestsMemory:  2Gi
   RequestsCPU:  0.5
   LimitsMemory:  2Gi
   LimitsCPU:  1.0
 large:
   RequestsMemory:  8Gi
   RequestsCPU:  2.0
   LimitsMemory:  12Gi
   LimitsCPU:  4.0&amp;lt;/pre&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;If these settings are set incorrectly or if the Kubernetes cluster
cannot meet the defined memory and CPU requirements, deployments will go into
a &amp;lt;strong&amp;gt;pending&amp;lt;/strong&amp;gt; state.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect2"&amp;gt;
&amp;lt;h3 id="_kube_rbac"&amp;gt;Kube RBAC&amp;lt;/h3&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;Release 2.6 added a &amp;lt;code&amp;gt;rbac.yaml&amp;lt;/code&amp;gt; file to capture the Kube RBAC
rules. These RBAC rules allow the &amp;lt;strong&amp;gt;apiserver&amp;lt;/strong&amp;gt; and &amp;lt;strong&amp;gt;postgres-operator&amp;lt;/strong&amp;gt;
containers access to the Kubernetes resources required for
the operator to work. As part of the deployment process, it is necessary to
execute the &amp;lt;code&amp;gt;rbac.yaml&amp;lt;/code&amp;gt; file to set the roles and bindings required by the
operator. Adjust this file to suit local security requirements.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect2"&amp;gt;
&amp;lt;h3 id="_application_rbac"&amp;gt;Application RBAC&amp;lt;/h3&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;Release 2.6 added an RBAC capability to secure the &amp;lt;strong&amp;gt;pgo&amp;lt;/strong&amp;gt; application.
The &amp;lt;strong&amp;gt;pgouser&amp;lt;/strong&amp;gt; now has a role appended at the end of of each user definition
as follows -&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="literalblock"&amp;gt;
&amp;lt;div class="content"&amp;gt;
&amp;lt;pre&amp;gt;username:password:pgoadmin
testuser:testpass:pgoadmin
readonlyuser:testpass:pgoreader&amp;lt;/pre&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;These are defined in the following file -&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="literalblock"&amp;gt;
&amp;lt;div class="content"&amp;gt;
&amp;lt;pre&amp;gt;$COROOT/conf/apiserver/pgouser&amp;lt;/pre&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;To match the behavior of the pre 2.6 releases, the &amp;lt;strong&amp;gt;pgadmin&amp;lt;/strong&amp;gt; role
is set on the previous user definitions, but a &amp;lt;strong&amp;gt;readonlyuser&amp;lt;/strong&amp;gt; is
now defined to test other role definitions. The roles are defined in
a new file called &amp;lt;strong&amp;gt;pgorole&amp;lt;/strong&amp;gt;. This file defines each role and the
permissions for that role. By default, two roles are defined as samples -&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="literalblock"&amp;gt;
&amp;lt;div class="content"&amp;gt;
&amp;lt;pre&amp;gt;pgoadmin
pgoreader&amp;lt;/pre&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;Adjust these default settings to meet local security requirements.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;The format of this file is as follows -&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="literalblock"&amp;gt;
&amp;lt;div class="content"&amp;gt;
&amp;lt;pre&amp;gt;rolename: permissionA, permissionB&amp;lt;/pre&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;These are defined in the following file -&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="literalblock"&amp;gt;
&amp;lt;div class="content"&amp;gt;
&amp;lt;pre&amp;gt;$COROOT/conf/apiserver/pgorole&amp;lt;/pre&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;The complete set of permissions is documented in the &amp;lt;a href="https://crunchydata.github.io/postgres-operator/latest/installation/configuration/"&amp;gt;Configuration&amp;lt;/a&amp;gt; document.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect2"&amp;gt;
&amp;lt;h3 id="_user_creation"&amp;gt;User Creation&amp;lt;/h3&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;Release 2.6 replaced the &amp;lt;code&amp;gt;pgo user --add&amp;lt;/code&amp;gt; command with the &amp;lt;code&amp;gt;pgo create user&amp;lt;/code&amp;gt;
command to improve consistency across command usage. Any scripts written
using the older style of command require an update to use the new command
syntax.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;div class="sect2"&amp;gt;
&amp;lt;h3 id="_replica_crd"&amp;gt;Replica CRD&amp;lt;/h3&amp;gt;
&amp;lt;div class="paragraph"&amp;gt;
&amp;lt;p&amp;gt;There is a new Kubernetes Custom Resource Definition that serves the purpose
of holding replica information, called &amp;lt;strong&amp;gt;pgreplicas&amp;lt;/strong&amp;gt;. This CRD is populated
with the pgo scale command and is used to hold per-replica specific information
such as the resource and storage configurations requested at run time.&amp;lt;/p&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="literalblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;    &amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>

    </div>
</div>
</div>


    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="https://crunchydata.github.io/postgres-operator/latest/installation/deployment/" title="Deployment"> <i class="fa fa-chevron-left"></i><label>Deployment</label></a>
    <a class="nav nav-next" href="https://crunchydata.github.io/postgres-operator/latest/getting-started/" title="Getting Started" style="margin-right: 0px;"><label>Getting Started</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  
    <div class="date">
        <i class='fa fa-calendar'></i>  24/04/2018
    </div>
    

  </div>


	<div>


  



	</div>
</footer>

<link href="https://crunchydata.github.io/postgres-operator/latest/css/featherlight.min.css" rel="stylesheet">
<script src="https://crunchydata.github.io/postgres-operator/latest/js/featherlight.min.js"></script>



<script src="https://crunchydata.github.io/postgres-operator/latest/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>